<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Test</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header>
        <div class="logo-container">
            <h1>Test Page</h1>
        </div>
        <nav>
            <a href="#">Test Link</a>
        </nav>
    </header>

    <main>
        <div class="image-grid">
            <div class="image-item">
                <img src="Placeholder Images (for initial setup).png" alt="Test Image">
            </div>
            <div class="image-item">
                <img src="Placeholder Images (for initial setup).png" alt="Test Image">
            </div>
        </div>
    </main>

    <footer>
        <p>Test Footer</p>
    </footer>

    <!-- Image Lightbox Modal -->
    <div id="image-lightbox" class="lightbox">
        <div class="lightbox-content">
            <span class="lightbox-close">&times;</span>
            <div class="lightbox-zoom-controls">
                <button id="zoom-in" class="zoom-btn" title="Zoom In">+</button>
                <button id="zoom-reset" class="zoom-btn" title="Reset Zoom">Reset</button>
                <button id="zoom-out" class="zoom-btn" title="Zoom Out">-</button>
            </div>
            <div class="lightbox-container">
                <img class="lightbox-img" id="lightbox-image" src="" alt="Enlarged image">
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="js/firebase-config.js"></script>

    <script>
        // Simple test lightbox script with zoom functionality
        document.addEventListener('DOMContentLoaded', function () {
            const imageItems = document.querySelectorAll('.image-item');
            const lightbox = document.getElementById('image-lightbox');
            const lightboxImg = document.getElementById('lightbox-image');
            const lightboxClose = document.querySelector('.lightbox-close');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const zoomResetBtn = document.getElementById('zoom-reset');

            // Zoom and drag variables
            let currentZoom = 1;
            let isDragging = false;
            let startX, startY, translateX = 0, translateY = 0;

            // Add click event to each image
            imageItems.forEach(item => {
                item.addEventListener('click', function () {
                    resetZoomAndPosition();
                    const imgSrc = this.querySelector('img').src;
                    lightboxImg.src = imgSrc;
                    lightbox.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            });

            // Close lightbox on click
            lightboxClose.addEventListener('click', function () {
                lightbox.classList.remove('active');
                document.body.style.overflow = '';
            });

            // Close lightbox when clicking outside the image
            lightbox.addEventListener('click', function (e) {
                if (e.target === lightbox) {
                    lightbox.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            // Zoom functionality
            function zoomIn() {
                if (currentZoom < 3) {
                    currentZoom += 0.25;
                    updateZoom();
                }
            }

            function zoomOut() {
                if (currentZoom > 0.5) {
                    currentZoom -= 0.25;
                    updateZoom();

                    if (currentZoom <= 1) {
                        translateX = 0;
                        translateY = 0;
                        updatePosition();
                    }
                }
            }

            function resetZoomAndPosition() {
                currentZoom = 1;
                translateX = 0;
                translateY = 0;
                updateZoom();
                updatePosition();
            }

            function updateZoom() {
                lightboxImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
            }

            function updatePosition() {
                lightboxImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
            }

            // Drag functionality
            function startDrag(e) {
                if (currentZoom > 1) {
                    isDragging = true;

                    if (e.type === 'mousedown') {
                        startX = e.clientX;
                        startY = e.clientY;
                    } else if (e.type === 'touchstart') {
                        startX = e.touches[0].clientX;
                        startY = e.touches[0].clientY;
                    }
                }
            }

            function drag(e) {
                if (!isDragging) return;

                e.preventDefault();

                let currentX, currentY;

                if (e.type === 'mousemove') {
                    currentX = e.clientX;
                    currentY = e.clientY;
                } else if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                }

                const deltaX = currentX - startX;
                const deltaY = currentY - startY;

                translateX += deltaX;
                translateY += deltaY;

                startX = currentX;
                startY = currentY;

                updatePosition();
            }

            function endDrag() {
                isDragging = false;
            }

            // Add event listeners for zoom controls
            zoomInBtn.addEventListener('click', zoomIn);
            zoomOutBtn.addEventListener('click', zoomOut);
            zoomResetBtn.addEventListener('click', resetZoomAndPosition);

            // Add event listeners for drag
            lightboxImg.addEventListener('mousedown', startDrag);
            lightboxImg.addEventListener('touchstart', startDrag);

            window.addEventListener('mousemove', drag);
            window.addEventListener('touchmove', drag, { passive: false });

            window.addEventListener('mouseup', endDrag);
            window.addEventListener('touchend', endDrag);

            // Zoom with mouse wheel
            lightboxImg.addEventListener('wheel', function (e) {
                e.preventDefault();
                if (e.deltaY < 0) {
                    zoomIn();
                } else {
                    zoomOut();
                }
            });

            // Double click to zoom in/out
            lightboxImg.addEventListener('dblclick', function (e) {
                e.preventDefault();
                if (currentZoom === 1) {
                    zoomIn();
                } else {
                    resetZoomAndPosition();
                }
            });

            // Close on escape key, and zoom with keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                if (lightbox.classList.contains('active')) {
                    if (e.key === 'Escape') {
                        lightbox.classList.remove('active');
                        document.body.style.overflow = '';
                    } else if (e.key === '+' || e.key === '=') {
                        zoomIn();
                    } else if (e.key === '-') {
                        zoomOut();
                    } else if (e.key === '0') {
                        resetZoomAndPosition();
                    }
                }
            });

            // Load images from Firebase if available
            async function loadTestImages() {
                try {
                    if (typeof firebaseStorage !== 'undefined') {
                        // Add a loading indicator
                        const grid = document.querySelector('.image-grid');
                        const loadingMsg = document.createElement('div');
                        loadingMsg.className = 'placeholder-message';
                        loadingMsg.textContent = 'Loading images from Firebase...';
                        grid.appendChild(loadingMsg);

                        const result = await firebaseStorage.getImages();

                        // Remove loading message
                        grid.removeChild(loadingMsg);

                        if (result.success && result.images.length > 0) {
                            console.log('Firebase images loaded for test page');

                            // Optionally display the images from Firebase
                            const firstImg = document.querySelector('.image-item img');
                            if (firstImg && result.images[0]) {
                                firstImg.src = result.images[0].src;
                            }

                            const secondImg = document.querySelectorAll('.image-item img')[1];
                            if (secondImg && result.images[1]) {
                                secondImg.src = result.images[1].src;
                            }
                        }
                    }
                } catch (error) {
                    console.log('Firebase not available or error loading images', error);

                    // Show error message but don't disrupt the test page
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'error-message';
                    errorMsg.textContent = 'Note: Firebase connection failed. Using local test images instead.';
                    errorMsg.style.fontSize = '0.8rem';
                    errorMsg.style.padding = '8px';
                    document.querySelector('main').prepend(errorMsg);
                }
            }

            // Try to load Firebase images
            loadTestImages();
        });
    </script>
</body>

</html>